<?xml version="1.0" encoding="UTF-8"?>
<database name="MusicPlaylist">
  <!-- Users -->
  <table name="User">
    <column name="UserID" type="INT" autoIncrement="true" primaryKey="true" notNull="true"/>
    <column name="Username" type="VARCHAR(50)" notNull="true" unique="true"/>
    <column name="Email" type="VARCHAR(100)" notNull="true" unique="true"/>
    <column name="CreatedAt" type="DATETIME" notNull="true" default="CURRENT_TIMESTAMP"/>
  </table>

  <!-- Songs -->
  <table name="Song">
    <column name="SongID" type="INT" autoIncrement="true" primaryKey="true" notNull="true"/>
    <column name="Title" type="VARCHAR(200)" notNull="true"/>
    <column name="Artist" type="VARCHAR(100)" notNull="true"/>
    <column name="Duration" type="TIME" notNull="true"/>
    <column name="Genre" type="VARCHAR(50)"/>
    <column name="ReleaseYear" type="SMALLINT"/>
  </table>

  <!-- Playlists -->
  <table name="Playlist">
    <column name="PlaylistID" type="INT" autoIncrement="true" primaryKey="true" notNull="true"/>
    <column name="Name" type="VARCHAR(100)" notNull="true"/>
    <column name="Description" type="TEXT"/>
    <column name="CreationDate" type="DATETIME" notNull="true" default="CURRENT_TIMESTAMP"/>
    <column name="CreatedBy_UserID" type="INT" notNull="true"/>
    <foreignKey name="fk_Playlist_User" column="CreatedBy_UserID" references="User(UserID)" onDelete="CASCADE"/>
    <index name="idx_Playlist_CreatedBy" column="CreatedBy_UserID"/>
  </table>

  <!-- Playback -->
  <table name="Playback">
    <column name="PlaybackID" type="INT" autoIncrement="true" primaryKey="true" notNull="true"/>
    <column name="Status" type="ENUM('playing','paused','stopped')" notNull="true"/>
    <column name="CurrentTime" type="TIME"/>
    <column name="ControlledBy_UserID" type="INT" notNull="true"/>
    <foreignKey name="fk_Playback_User" column="ControlledBy_UserID" references="User(UserID)" onDelete="CASCADE"/>
    <index name="idx_Playback_ControlledBy" column="ControlledBy_UserID"/>
  </table>

  <!-- PlaylistSong (Associative Entity) -->
  <table name="PlaylistSong">
    <column name="PlaylistID" type="INT" notNull="true"/>
    <column name="SongID" type="INT" notNull="true"/>
    <column name="Order" type="SMALLINT" notNull="true"/>
    <primaryKey>
      <column name="PlaylistID"/>
      <column name="SongID"/>
    </primaryKey>
    <foreignKey name="fk_PS_Playlist" column="PlaylistID" references="Playlist(PlaylistID)" onDelete="CASCADE"/>
    <foreignKey name="fk_PS_Song" column="SongID" references="Song(SongID)" onDelete="CASCADE"/>
    <index name="idx_PS_Song" column="SongID"/>
    <index name="idx_PS_Playlist" column="PlaylistID"/>
  </table>
</database>
